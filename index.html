<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –º–µ—á—Ç—ã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
        }
        
        .app-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 4px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .user-info {
            margin-bottom: 20px;
            color: #555;
        }
        
        .progress-container {
            margin: 30px 0;
        }
        
        .progress-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .stats {
            color: #666;
            margin: 10px 0;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            font-weight: bold;
            transition: transform 0.1s;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .destination {
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }
        
        .loading {
            color: #999;
            margin: 20px 0;
        }
        
        .debug {
            background: #222;
            color: #0f0;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            font-size: 12px;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <h1>‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –º–µ—á—Ç—ã</h1>
        
        <div id="user-info" class="user-info">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        
        <div class="destination">
            üéØ –¢–≤–æ—è —Ü–µ–ª—å: –ü–∞—Ä–∏–∂
        </div>
        
        <div class="progress-container">
            <div class="stats">
                <span id="distance">0</span> –∫–º –∏–∑ <span id="total">1000</span> –∫–º
            </div>
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
            </div>
        </div>
        
        <button id="step-btn" class="btn">üë£ –°–¥–µ–ª–∞—Ç—å —à–∞–≥</button>
        <button id="share-btn" class="btn">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º</button>
        
        <div class="debug" id="debug"></div>
    </div>

    <script>
        // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–≥–µ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        function log(message) {
            const debugEl = document.getElementById('debug');
            debugEl.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}<br>`;
            console.log(message);
        }

        // Telegram WebApp SDK
        const tg = window.Telegram?.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            log("DOM –∑–∞–≥—Ä—É–∂–µ–Ω. –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...");
            initApp();
        });
        
        async function initApp() {
            try {
                log("–ü—ã—Ç–∞–µ–º—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...");
                
                const userInfoEl = document.getElementById('user-info');
                const stepBtn = document.getElementById('step-btn');
                const shareBtn = document.getElementById('share-btn');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram
                if (!tg) {
                    log("‚ö†Ô∏è –ù–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω Telegram WebApp SDK!");
                    userInfoEl.textContent = '‚ö†Ô∏è –û—Ç–∫—Ä–æ–π —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram!';
                    stepBtn.disabled = true;
                    shareBtn.disabled = true;
                    return;
                }
                
                log("Telegram WebApp SDK –Ω–∞–π–¥–µ–Ω! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º...");
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const initData = tg.initDataUnsafe;
                log(`–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(initData)}`);
                
                const user = initData?.user;
                if (user) {
                    userInfoEl.innerHTML = `üë§ –ü—Ä–∏–≤–µ—Ç, <strong>${user.first_name || '–¥—Ä—É–≥'}</strong>!`;
                } else {
                    userInfoEl.textContent = 'üë§ –ì–æ—Ç–æ–≤ –∫ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—é!';
                }
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–µ–º—É
                try {
                    tg.expand();
                    log("–†–∞—Å—à–∏—Ä–∏–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞");
                } catch (e) {
                    log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞: ${e.message}`);
                }
                
                try {
                    tg.ready();
                    log("Telegram WebApp –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ");
                } catch (e) {
                    log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ ready(): ${e.message}`);
                }
                
                // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã
                const TOTAL_DISTANCE = 1000; // –∫–º –¥–æ –ü–∞—Ä–∏–∂–∞
                let distance = parseInt(localStorage.getItem('travel_distance')) || 0;
                log(`–¢–µ–∫—É—â–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distance} –∫–º`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                updateProgress(distance, TOTAL_DISTANCE);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–®–∞–≥"
                stepBtn.addEventListener('click', () => {
                    log("–ö–Ω–æ–ø–∫–∞ '–°–¥–µ–ª–∞—Ç—å —à–∞–≥' –Ω–∞–∂–∞—Ç–∞");
                    distance += Math.floor(Math.random() * 10) + 1; // 1-10 –∫–º –∑–∞ —à–∞–≥
                    if (distance > TOTAL_DISTANCE) distance = TOTAL_DISTANCE;
                    
                    localStorage.setItem('travel_distance', distance);
                    updateProgress(distance, TOTAL_DISTANCE);
                    log(`–ù–æ–≤–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distance} –∫–º`);
                    
                    // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏
                    if (distance >= TOTAL_DISTANCE) {
                        log("–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ");
                        tg.showPopup({
                            title: 'üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!',
                            message: `–¢—ã –¥–æ–±—Ä–∞–ª—Å—è –¥–æ –ü–∞—Ä–∏–∂–∞! –°–¥–µ–ª–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç –∏ –ø–æ–¥–µ–ª–∏—Å—å —Å –¥—Ä—É–∑—å—è–º–∏!`,
                            buttons: [{ type: 'ok' }]
                        });
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
                shareBtn.addEventListener('click', () => {
                    log("–ö–Ω–æ–ø–∫–∞ '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è' –Ω–∞–∂–∞—Ç–∞");
                    const percent = Math.round((distance / TOTAL_DISTANCE) * 100);
                    const message = `üöÄ –Ø —É–∂–µ –ø—Ä–æ—à—ë–ª ${distance} –∫–º (${percent}%) –ø—É—Ç–∏ –¥–æ –ü–∞—Ä–∏–∂–∞ –≤ @${tg.initDataUnsafe?.username || 'travel_bot'}! –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è!`;
                    
                    try {
                        tg.shareText(message);
                        log("–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ç–µ–∫—Å—Ç–æ–º —É—Å–ø–µ—à–Ω–∞");
                    } catch (e) {
                        log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —à–µ—Ä–∏–Ω–≥–µ: ${e.message}`);
                    }
                });
                
                log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!");
                
            } catch (error) {
                log(`–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ${error.message}`);
                console.error(error);
            }
        }
        
        function updateProgress(current, total) {
            const percent = Math.min(100, Math.round((current / total) * 100));
            
            document.getElementById('distance').textContent = current;
            document.getElementById('total').textContent = total;
            document.getElementById('progress-fill').style.width = `${percent}%`;
        }
    </script>
</body>
</html>
